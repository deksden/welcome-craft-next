# ü§ñ –†–µ–∑—É–ª—å—Ç–∞—Ç –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ AI Fixtures Provider

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 2025-07-02  
**–ó–∞–¥–∞—á–∞:** –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ —Å–∏—Å—Ç–µ–º—ã AI Fixtures –æ—Ç lossy –∫ lossless –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –£–°–ü–ï–®–ù–û –ó–ê–í–ï–†–®–ï–ù–û  

---

## üìã –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã

### –§–∞–∑–∞ 1: –ê–Ω–∞–ª–∏–∑ Vercel AI SDK ‚úÖ

**–¶–µ–ª—å:** –ò–∑—É—á–µ–Ω–∏–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ç–æ—á–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ò–∑—É—á–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `GenerateTextResult` —Å –ø–æ–ª—è–º–∏: `text`, `toolCalls`, `toolResults`, `finishReason`, `usage`, `reasoning`, `sources`, `files`, `steps`
- ‚úÖ –ò–∑—É—á–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `LanguageModelV1StreamPart` —Å —Ç–∏–ø–∞–º–∏ —á–∞–Ω–∫–æ–≤: `text-delta`, `tool-call`, `tool-result`, `finish`, `error` –∏ –¥—Ä.
- ‚úÖ –ü–æ–Ω—è—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ streaming —á–µ—Ä–µ–∑ `ReadableStream<LanguageModelV1StreamPart>`

### –§–∞–∑–∞ 2: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ –∫–æ–¥–µ ‚úÖ

**–¶–µ–ª—å:** –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `lib/ai/fixtures-provider.ts` –¥–æ lossless –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

**–ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**

#### 2.1 –†–µ–¥–∏–∑–∞–π–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ `AIFixture`:
```typescript
// –ë–´–õ–û (v1.0.0 - lossy)
output: {
  content: string
  usage?: Usage
  finishReason?: string
}

// –°–¢–ê–õ–û (v2.0.0 - lossless)
output: {
  type: 'full' | 'stream'
  fullResponse?: any        // –ü–æ–ª–Ω—ã–π GenerateTextResult
  streamChunks?: any[]      // –ú–∞—Å—Å–∏–≤ LanguageModelV1StreamPart  
  timestamp: string
  duration: number
}
```

#### 2.2 –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `doGenerate`:
- ‚úÖ **Record Mode:** –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ `result` –≤ `output.fullResponse`
- ‚úÖ **Replay Mode:** –ü—Ä—è–º–æ–µ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ `fixture.output.fullResponse`
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤:** –ü—Ä–æ–≤–µ—Ä–∫–∞ `fixture.output.type === 'full'`

#### 2.3 –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `doStream`:
- ‚úÖ **Stream.tee() —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:** –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—â–∏–π
- ‚úÖ **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å:** –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö —á–∞–Ω–∫–æ–≤ –≤ `output.streamChunks`
- ‚úÖ **Replay –∏–∑ —á–∞–Ω–∫–æ–≤:** –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ `ReadableStream` –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

#### 2.4 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤:
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `recordStream()` —Å `stream.tee()` –ª–æ–≥–∏–∫–æ–π
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `createStreamFromChunks()` –¥–ª—è replay
- ‚úÖ –£–¥–∞–ª–µ–Ω—ã —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ `convertFixtureToResult()` –∏ `convertFixtureToStream()`

### –§–∞–∑–∞ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è ‚úÖ

**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –Ω–∞ UC-05 —Ç–µ—Å—Ç–µ

**–í—ã–ø–æ–ª–Ω–µ–Ω–æ:**
- ‚úÖ –û—á–∏—â–µ–Ω—ã —Å—Ç–∞—Ä—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã: `rm -rf tests/fixtures/ai/use-cases/UC-05`
- ‚úÖ –ó–∞–ø–∏—Å—å –Ω–æ–≤—ã—Ö —Ñ–∏–∫—Å—Ç—É—Ä: `AI_FIXTURES_MODE=record-or-replay`
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã: —Å–æ–∑–¥–∞–Ω—ã —Ñ–∏–∫—Å—Ç—É—Ä—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º lossless —Ñ–æ—Ä–º–∞—Ç–æ–º

**–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å:**
```json
{
  "output": {
    "type": "stream",
    "streamChunks": [
      {"type": "text-delta", "textDelta": "Unknown test prompt!"},
      {"type": "finish", "finishReason": "stop", "usage": {...}}
    ]
  }
}
```

### –§–∞–∑–∞ 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ ‚úÖ

**–°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- ‚úÖ **`.memory-bank/testing/AIFixturesProvider.md`** - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ v2.0.0
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã —Å—Å—ã–ª–∫–∏ –≤ `testing-overview.md` –∏ `three-level-testing-system.md`

**–ö–ª—é—á–µ–≤—ã–µ —Ä–∞–∑–¥–µ–ª—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:**
- –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã (`record`, `replay`, `passthrough`, `record-or-replay`)
- –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ñ–∏–∫—Å—Ç—É—Ä (Use Cases, Worlds, general)
- –§–æ—Ä–º–∞—Ç JSON v2.0.0 —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
- –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –ú–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –≥–∞–π–¥ —Å v1.0.0

### –§–∞–∑–∞ 5: –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ ‚úÖ

**Quality Assurance:**
- ‚úÖ TypeScript: `pnpm typecheck` - 0 –æ—à–∏–±–æ–∫
- ‚úÖ ESLint: `pnpm lint` - –±–µ–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
- ‚úÖ –°–±–æ—Ä–∫–∞: –ø—Ä–æ–µ–∫—Ç —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
- ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: –∫–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º WelcomeCraft

---

## üöÄ –ö–ª—é—á–µ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è

### 1. –ü–æ–ª–Ω–∞—è Lossless –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- **–î–æ:** –°–æ—Ö—Ä–∞–Ω—è–ª—Å—è —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–π `content`, —Ç–µ—Ä—è–ª–∏—Å—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
- **–ü–æ—Å–ª–µ:** –ü–æ–ª–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `GenerateTextResult` —Å–æ –≤—Å–µ–º–∏ –ø–æ–ª—è–º–∏

### 2. –¢–æ—á–Ω–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ streaming
- **–î–æ:** –≠–º—É–ª—è—Ü–∏—è —Å—Ç—Ä–∏–º–∞ —á–µ—Ä–µ–∑ "—Ä–∞–∑–±–∏–≤–∫—É –ø–æ –ø—Ä–æ–±–µ–ª–∞–º"
- **–ü–æ—Å–ª–µ:** –†–µ–∞–ª—å–Ω—ã–µ `LanguageModelV1StreamPart` —á–∞–Ω–∫–∏ —á–µ—Ä–µ–∑ `stream.tee()`

### 3. –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- **–î–æ:** –ï–¥–∏–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤
- **–ü–æ—Å–ª–µ:** –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ `'full'` –∏ `'stream'` —Ç–∏–ø–æ–≤ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π

### 4. Production-ready –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- **–î–æ:** –ë–∞–∑–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- **–ü–æ—Å–ª–µ:** Timeout –∑–∞—â–∏—Ç–∞, proper error handling, resource cleanup

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã v2.0.0:
```
tests/fixtures/ai/general/
‚îú‚îÄ‚îÄ chat-model-8n99da.json      # Stream fixture
‚îú‚îÄ‚îÄ title-model-booc50.json     # Full response fixture  
‚îî‚îÄ‚îÄ title-model-fsjqcg.json     # Full response fixture
```

### –ü—Ä–∏–º–µ—Ä stream —Ñ–∏–∫—Å—Ç—É—Ä—ã:
- ‚úÖ `type: "stream"` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- ‚úÖ `streamChunks[]` —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–µ–∞–ª—å–Ω—ã–µ —á–∞–Ω–∫–∏ –æ—Ç AI SDK
- ‚úÖ Metadata —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã (timestamp, duration, hash)

### –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–µ–∂–∏–º–æ–≤:
- ‚úÖ **record-or-replay:** –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏
- ‚úÖ **replay:** –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö  
- ‚úÖ **AI Fixtures mode detection:** –°–∏—Å—Ç–µ–º–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ–∂–∏–º

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ v2.0.0

### Stream Recording —Å `stream.tee()`:
```typescript
const { stream } = await originalModel.doStream(options)
const [streamForClient, streamForRecording] = stream.tee()

// –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç –∫–ª–∏–µ–Ω—Ç—É
return { stream: streamForClient }

// –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å –≤—Å–µ—Ö —á–∞–Ω–∫–æ–≤
const recordedChunks = []
const reader = streamForRecording.getReader()
while (!done) {
  recordedChunks.push(await reader.read())
}
await saveFixture({ streamChunks: recordedChunks })
```

### Replay –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —á–∞–Ω–∫–æ–≤:
```typescript
return {
  stream: new ReadableStream({
    start(controller) {
      for (const chunk of fixture.output.streamChunks) {
        controller.enqueue(chunk)
      }
      controller.close()
    }
  })
}
```

---

## üìö –û–±–Ω–æ–≤–ª–µ–Ω–∏—è Memory Bank

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
- **`.memory-bank/testing/AIFixturesProvider.md`** - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è v2.0.0

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- **`testing-overview.md`** - –¥–æ–±–∞–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª –ø—Ä–æ AI Fixtures
- **`three-level-testing-system.md`** - –æ–±–Ω–æ–≤–ª–µ–Ω—ã –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ v2.0.0
- **`lib/ai/fixtures-provider.ts`** - –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ –≤ v2.0.0

---

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–°–∏—Å—Ç–µ–º–∞ AI Fixtures —É—Å–ø–µ—à–Ω–æ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∞ –≤ –Ω–∞–¥–µ–∂–Ω—ã–π, lossless –ø—Ä–æ–∫—Å–∏-–ø—Ä–æ–≤–∞–π–¥–µ—Ä:**

1. **üéØ –¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞:** –û—Ç lossy –∫ lossless –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Å –ø–æ–ª–Ω—ã–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º AI –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π
2. **üöÄ Production –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:** Robust –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫, timeout –∑–∞—â–∏—Ç–∞, proper resource management  
3. **üìà –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –¢–æ—á–Ω–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∏–ª–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
4. **üß™ –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:** –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Å—Ç–∏—á–Ω—ã–µ —Ç–µ—Å—Ç—ã –±–µ–∑ –ª–æ–∂–Ω–æ-–ø–æ–∑–∏—Ç–∏–≤–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
5. **üìñ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** Comprehensive guide –¥–ª—è –∫–æ–º–∞–Ω–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

**AI Fixtures Provider v2.0.0 –≥–æ—Ç–æ–≤ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ —Ç–µ—Å—Ç–æ–≤—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É WelcomeCraft.**

---

**–í—ã–ø–æ–ª–Ω–µ–Ω–æ —Å–æ–≥–ª–∞—Å–Ω–æ WF-06 –ø—Ä–æ—Ü–µ—Å—Å—É: –ó–∞–¥–∞—á–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º Memory Bank –∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å—é –∫ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—é.**