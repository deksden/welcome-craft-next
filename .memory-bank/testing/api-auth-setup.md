# üîê –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ API —Ç–µ—Å—Ç–∞—Ö

## HISTORY:

* v1.0.0 (2025-06-13): –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–ª–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ Playwright API —Ç–µ—Å—Ç–∞—Ö.

---

## –ü—Ä–æ–±–ª–µ–º–∞

API —Ç–µ—Å—Ç—ã –≤ Playwright –Ω–µ –º–æ–≥–ª–∏ –ø—Ä–æ–π—Ç–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é, –ø–æ–ª—É—á–∞—è 401 –æ—à–∏–±–∫–∏, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–æ–∑–¥–∞–≤–∞–ª–∏—Å—å –∏ –ª–æ–≥–∏–Ω–∏–ª–∏—Å—å —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

### –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞
NextAuth.js –∏—Å–ø–æ–ª—å–∑—É–µ—Ç HTTP-only cookies –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–æ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ API fixtures —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Ç–µ—Å—Ç–æ–≤—ã–π endpoint ‚úÖ
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ª–æ–≥–∏–Ω–∏—Ç—Å—è —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä–Ω—É—é —Ñ–æ—Ä–º—É ‚úÖ  
3. NextAuth —Å–æ–∑–¥–∞–µ—Ç cookies (–≤–∫–ª—é—á–∞—è `authjs.session-token`) ‚úÖ
4. **–ù–û** API request context –ù–ï –ø–æ–ª—É—á–∞–µ—Ç —ç—Ç–∏ cookies –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚ùå

## –†–µ—à–µ–Ω–∏–µ

### 1. –ü–µ—Ä–µ–¥–∞—á–∞ cookies –∏–∑ browser context –≤ API request context

```typescript
// tests/api-fixtures.ts
const cookies = await context.cookies();
const cookieHeader = cookies.map(cookie => `${cookie.name}=${cookie.value}`).join('; ');

// –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –º–µ—Ç–æ–¥—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è cookies
authenticatedRequest.get = (url: string, options: any = {}) => {
  return originalGet(url, {
    ...options,
    headers: {
      ...options.headers,
      'Cookie': cookieHeader,
    }
  });
};
```

### 2. –ö–ª—é—á–µ–≤—ã–µ cookies –¥–ª—è NextAuth
- `authjs.session-token` - –æ—Å–Ω–æ–≤–Ω–æ–π JWT —Ç–æ–∫–µ–Ω —Å–µ—Å—Å–∏–∏
- `authjs.csrf-token` - CSRF –∑–∞—â–∏—Ç–∞  
- `authjs.callback-url` - URL –¥–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤

### 3. –í–∞–∂–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**Domain consistency:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –¥–æ–º–µ–Ω –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞ –∏ API:
```typescript
// –ë—ã–ª–æ: localhost –¥–ª—è API, app.localhost –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞ ‚ùå
// –°—Ç–∞–ª–æ: app.localhost –¥–ª—è –≤—Å–µ–≥–æ ‚úÖ
```

**Force click:** –ö–Ω–æ–ø–∫–∏ –º–æ–≥—É—Ç –±—ã—Ç—å disabled, –∏—Å–ø–æ–ª—å–∑—É–µ–º force click:
```typescript
await page.click('[data-testid="auth-submit-button"]', { force: true });
```

**Network idle:** –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–µ—Ç–µ–≤–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞:
```typescript
await page.waitForLoadState('networkidle', { timeout: 10000 });
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

- **–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 8 passed, 8 failed (401 –æ—à–∏–±–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)
- **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 12 passed, 8 failed (–ø—Ä–æ–±–ª–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ä–µ—à–µ–Ω—ã!)

–û—Å—Ç–∞–≤—à–∏–µ—Å—è 8 failed —Ç–µ—Å—Ç–æ–≤ —Å–≤—è–∑–∞–Ω—ã —Å –ª–æ–≥–∏–∫–æ–π API endpoints, –∞ –Ω–µ —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π.

## –ü—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç—å

–≠—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ –¥–ª—è –ª—é–±—ã—Ö NextAuth.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Å Playwright API —Ç–µ—Å—Ç–∞–º–∏, –≥–¥–µ –Ω—É–∂–Ω–æ:
- –°–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ
- –õ–æ–≥–∏–Ω–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å  
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ API endpoints

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã

1. **–ü—Ä—è–º–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–æ–≤** - —Å–ª–æ–∂–Ω–µ–µ, —Ç—Ä–µ–±—É–µ—Ç –∑–Ω–∞–Ω–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–æ—Å—Ç–µ–π NextAuth
2. **Mock authentication** - –Ω–µ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π auth flow
3. **–ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π –ª–æ–≥–∏–Ω —á–µ—Ä–µ–∑ API** - —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö endpoints

–í—ã–±—Ä–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –æ–ø—Ç–∏–º–∞–ª–µ–Ω, —Ç–∞–∫ –∫–∞–∫ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π flow –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.