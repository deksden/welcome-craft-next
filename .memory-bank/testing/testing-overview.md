# üß™ Testing Overview

**–í–µ—Ä—Å–∏—è:** 3.0.0  
**–î–∞—Ç–∞:** 2025-06-16  
**–ò—Å—Ç–æ—á–Ω–∏–∫:** testing-context.md  
**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** –î–æ–±–∞–≤–ª–µ–Ω –∞–∫—Ç—É–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ Sparse Columns —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

---

## üéØ –§–∏–ª–æ—Å–æ—Ñ–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

WelcomeCraft –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–≥–∏–±—Ä–∏–¥–Ω—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –≤—ã—Å–æ–∫–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏.

### –ü–∏—Ä–∞–º–∏–¥–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
1. **–Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã (Vitest)** ‚Äî –æ—Å–Ω–æ–≤–∞–Ω–∏–µ –ø–∏—Ä–∞–º–∏–¥—ã
   - –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏ –º–æ–¥—É–ª–µ–π
   - –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
   
2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (Playwright)** ‚Äî –≤–µ—Ä—Ö—É—à–∫–∞ –ø–∏—Ä–∞–º–∏–¥—ã  
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ API routes –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–∏, –±–ª–∏–∑–∫–æ–º –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É

3. **E2E —Ç–µ—Å—Ç—ã (Playwright)** ‚Äî —Å–∫–≤–æ–∑–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
   - AI-first workflow, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∞–π—Ç–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã —Ü–µ–ª–∏–∫–æ–º

---

## üõ†Ô∏è –°—Ç–µ–∫ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### Vitest ‚Äî –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `tests/unit/`
- **–ó–∞–ø—É—Å–∫:** `pnpm test:unit` | `pnpm test:unit:watch`
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** `vitest.config.ts`
- **–û–∫—Ä—É–∂–µ–Ω–∏–µ:** `jsdom` –¥–ª—è —ç–º—É–ª—è—Ü–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞
- **–ê–ª–∏–∞—Å—ã:** –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `@/...` —á–µ—Ä–µ–∑ `vite-tsconfig-paths`
- **–ú–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ:** `vi.mock()` –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### Playwright ‚Äî –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏ E2E —Ç–µ—Å—Ç—ã  
- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `tests/e2e/`, `tests/routes/`
- **–ó–∞–ø—É—Å–∫:** `pnpm test`
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** `playwright.config.ts`
- **–ë—Ä–∞—É–∑–µ—Ä—ã:** Chrome, Firefox, Safari
- **–°–µ–ª–µ–∫—Ç–æ—Ä—ã:** –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `data-testid`

---

## üéØ –•–µ–ª–ø–µ—Ä—ã –∏ —É—Ç–∏–ª–∏—Ç—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ö–µ–ª–ø–µ—Ä—ã
- **`tests/helpers/test-utils.ts`** ‚Äî —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è AI
- **`tests/helpers/ai-mock.ts`** ‚Äî –º–æ–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤ AI
- **`tests/helpers/auth-helper.ts`** ‚Äî –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤ —Ç–µ—Å—Ç–∞—Ö
- **`tests/helpers/ui-helpers.ts`** ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ UI —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
- **`tests/fixtures.ts`** ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### UI Testing —Å–∏—Å—Ç–µ–º–∞
- **–ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ testid:** –ø—Ä–µ—Ñ–∏–∫—Å—ã –ø–æ –∑–æ–Ω–∞–º UI
  - `header-*` ‚Äî —à–∞–ø–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  - `sidebar-*` ‚Äî –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å  
  - `chat-*` ‚Äî –∑–æ–Ω–∞ —á–∞—Ç–∞
  - `artifact-*` ‚Äî –ø–∞–Ω–µ–ª—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
- **UI —Ö–µ–ª–ø–µ—Ä—ã:** `ui.header.createNewChat()`, `ui.chatInput.sendMessage()`

---

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ—Å—Ç–æ–≤

### –î–ª—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏/–º–æ–¥—É–ª—è
1. **–Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –ø–µ—Ä–≤—ã–º–∏** ‚Äî –ø–æ–∫—Ä—ã—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –≤ `lib/`
2. **–ú–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** ‚Äî –ë–î, API, `server-only`
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏**

### –î–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è
1. **E2E —Ç–µ—Å—Ç** ‚Äî —Å–æ–∑–¥–∞—Ç—å –≤ `tests/e2e/`
2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å testid** ‚Äî –¥–ª—è –Ω–∞–¥–µ–∂–Ω—ã—Ö —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤
3. **–°–ª–µ–¥–æ–≤–∞—Ç—å UX —Ñ–ª–æ—É** ‚Äî –∏–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

### –ü–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º
```bash
pnpm typecheck && pnpm lint && pnpm test:unit
```

### –ü–µ—Ä–µ–¥ Pull Request
```bash
pnpm test  # –ü–æ–ª–Ω—ã–π –ø—Ä–æ–≥–æ–Ω –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
```

---

## üìä –ê–∫—Ç—É–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å

### ‚úÖ –†–∞–±–æ—Ç–∞—é—â–∏–µ —Ç–µ—Å—Ç—ã

**Route —Ç–µ—Å—Ç—ã (71/71 –ø—Ä–æ—Ö–æ–¥—è—Ç):**
- `artifact.test.ts` ‚Äî API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞–º–∏
- `artifacts.test.ts` ‚Äî –º–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞–º–∏  
- `auth.test.ts` ‚Äî –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- `redis-clipboard.test.ts` ‚Äî Redis –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
- `files-upload.test.ts` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤

**E2E —Ç–µ—Å—Ç—ã (–±–∞–∑–æ–≤—ã–µ):**
- `simple-test.test.ts` ‚Äî –±–∞–∑–æ–≤–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `basic-chat.test.ts` ‚Äî —á–∞—Ç —Å test auth
- `auth-test.test.ts` ‚Äî —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ test auth API

**–Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã:**
- `tests/unit/artifacts/tools/*.test.ts` ‚Äî ‚úÖ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –ø–æ–¥ Sparse Columns

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏

**E2E —Ç–µ—Å—Ç—ã —Å Auth.js:**
- –ü—Ä–æ–±–ª–µ–º—ã —Å –º—É–ª—å—Ç–∏-–¥–æ–º–µ–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π
- Redirect loops –º–µ–∂–¥—É `app.localhost` –∏ `localhost`
- **–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –Ω–∞ test auth —Å–∏—Å—Ç–µ–º—É

**AI workflow —Ç–µ—Å—Ç—ã:**
- –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏–∑-–∑–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤ –≤–Ω–µ—à–Ω–∏—Ö AI —Å–µ—Ä–≤–∏—Å–æ–≤
- **–°—Ç–∞—Ç—É—Å:** –°–∫–∏–ø–Ω—É—Ç—ã –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ (`11 skipped`)

---

## üîß –†–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤ —Ç–µ—Å—Ç–∞—Ö
- **–ü—Ä–æ–±–ª–µ–º–∞:** Auth.js v5 + PostgreSQL + Playwright —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
- **–†–µ—à–µ–Ω–∏–µ:** Custom test auth middleware —Å –≤–∞–ª–∏–¥–Ω—ã–º–∏ UUID
- **API:** `/api/test/auth-signin` —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ—Å—Ç—ã–µ JSON session cookies

### –ú—É–ª—å—Ç–∏-–¥–æ–º–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- **–ü—Ä–æ–±–ª–µ–º–∞:** Cookies –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –º–µ–∂–¥—É –¥–æ–º–µ–Ω–∞–º–∏
- **–†–µ—à–µ–Ω–∏–µ:** –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞ –æ–¥–Ω–æ–º –¥–æ–º–µ–Ω–µ –≤ —Ç–µ—Å—Ç–∞—Ö
- **–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è:** `PLAYWRIGHT_PORT` –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –ø–æ—Ä—Ç–æ–≤

### Drizzle JSON –∞–≤—Ç–æ–ø–∞—Ä—Å–∏–Ω–≥
- **–ü—Ä–æ–±–ª–µ–º–∞:** `json('content').$type<string>()` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–∞—Ä—Å–∏—Ç
- **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç –∫–∞–∫ –æ–±—ä–µ–∫—Ç, –±–µ–∑ `JSON.parse()`

---

## üöÄ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—Ä–æ–∫–∏

1. **Auth.js v5 + PostgreSQL + Playwright = —Å–ª–æ–∂–Ω–æ—Å—Ç—å**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ custom test auth –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã

2. **–ú—É–ª—å—Ç–∏-–¥–æ–º–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ cookie –∏ redirect —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∑–∞—Ä–∞–Ω–µ–µ

3. **Playwright async config –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–Ω–æ–≥–æ —Ä–∞–∑**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ environment variables –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏

4. **–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ä–µ–¥–∞ ‚â† Production**
   - API –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞–≥–ª—É—à–µ–Ω—ã, —É—á–∏—Ç—ã–≤–∞–π—Ç–µ —ç—Ç–æ –≤ —Ç–µ—Å—Ç–∞—Ö

5. **Sparse Columns —Ç—Ä–µ–±—É—é—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è mock –¥–∞–Ω–Ω—ã—Ö**
   - –ü—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ –ë–î –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –≤—Å–µ —Ç–µ—Å—Ç—ã –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ

---

> **–ò—Ç–æ–≥:** –°–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ. Route —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç 71/71, —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã, –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã.