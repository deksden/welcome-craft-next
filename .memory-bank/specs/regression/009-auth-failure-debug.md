# üîÑ –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–µ–≥—Ä–µ—Å—Å–∏–∏: –ü—Ä–æ–±–ª–µ–º–∞ —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π - —Å–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ

**ID:** BUG-009  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–î–∞—Ç–∞:** 2025-06-18  
**–°–≤—è–∑–∞–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞:** `.memory-bank/buglog.md#BUG-009`  
**üåç –¢–µ—Å—Ç–æ–≤—ã–π –º–∏—Ä:** `PRODUCTION` (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–µ–∂–∏–º)  
**üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∞:** –ñ–µ–ª–µ–∑–æ–±–µ—Ç–æ–Ω–Ω—ã–µ –¢–µ—Å—Ç—ã (POM + Fail-fast + Auth validation)

---

## üìù –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É –ª–æ–≥–∏–Ω–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–±—Ä–æ—Å –ø–æ–ª—è –ø–∞—Ä–æ–ª—è, –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ª–æ–≥–∏–Ω–∞ –±–µ–∑ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è. –ü—Ä–æ–±–ª–µ–º–∞ —Å–≤—è–∑–∞–Ω–∞ —Å Zod –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π - `formData.get('world_id')` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç null, –Ω–æ `optional()` –æ–∂–∏–¥–∞–µ—Ç undefined.

---

## üéØ –°—Ü–µ–Ω–∞—Ä–∏–π –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è

### –î–∞–Ω–æ:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ª–æ–≥–∏–Ω–∞ `/login`
- –§–æ—Ä–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å –ø–æ–ª—è–º–∏ email –∏ password
- World selector –≤ —Ä–µ–∂–∏–º–µ PRODUCTION (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- –°–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ Auth.js –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### –ö–æ–≥–¥–∞:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø–æ–ª–Ω—è–µ—Ç email: `test@example.com`
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø–æ–ª–Ω—è–µ—Ç password: `test123`
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —á—Ç–æ world selector —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ PRODUCTION
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "Sign in"

### –¢–æ–≥–¥–∞ (–û–∂–∏–¥–∞–µ–º–æ–µ):
- –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É `/`
- –ü–æ–ª–µ –ø–∞—Ä–æ–ª—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤–æ –≤—Ä–µ–º—è –ø—Ä–æ—Ü–µ—Å—Å–∞

### –ê (–§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ):
- –ü–æ–ª–µ –ø–∞—Ä–æ–ª—è –æ—á–∏—â–∞–µ—Ç—Å—è (—Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ª–æ–≥–∏–Ω–∞
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
- –í–æ–∑–º–æ–∂–Ω—ã –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ Zod —Å—Ö–µ–º–µ

---

## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ

### –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:
–ü—Ä–æ–±–ª–µ–º–∞ –≤ server action –≤–∞–ª–∏–¥–∞—Ü–∏–∏ - `formData.get('world_id')` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `null` –¥–ª—è PRODUCTION —Ä–µ–∂–∏–º–∞, –Ω–æ Zod schema `optional()` –æ–∂–∏–¥–∞–µ—Ç `undefined`. –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –æ—à–∏–±–∫–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏.

### –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- `app/(auth)/login/page.tsx` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–æ–≥–∏–Ω–∞  
- Auth.js server actions –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- Zod –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ö–µ–º—ã —Ñ–æ—Ä–º—ã –ª–æ–≥–∏–Ω–∞
- World selector component

### –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ:
–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ `null ‚Üí undefined` –≤ Zod –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ null –∑–Ω–∞—á–µ–Ω–∏–π –≤ server action.

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

**üîó –°–≤—è–∑–∞–Ω–Ω—ã–π —Ç–µ—Å—Ç:** `tests/e2e/regression/009-auth-failure-debug.test.ts`

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏

1. **üîç –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:**
   - –ü–æ–ª–µ –ø–∞—Ä–æ–ª—è –æ—á–∏—â–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ª–æ–≥–∏–Ω–∞
   - –ù–µ—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è

2. **üß™ –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
   - Network requests –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è
   - Console errors —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è
   - Form state –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è

3. **üìã –ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è:**
   - –¢–µ—Å—Ç —Å–ª–µ–¥—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º –ñ–µ–ª–µ–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –¢–µ—Å—Ç–æ–≤
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç fail-fast –ª–æ–∫–∞—Ç–æ—Ä—ã
   - –ß–µ—Ç–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã

---

> **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** High - –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π