# üë®‚Äçüíª`.memory-bank/dev-context.md`: –ö–æ–Ω—Ç–µ–∫—Å—Ç –¢–µ–∫—É—â–µ–π –†–∞–∑—Ä–∞–±–æ—Ç–∫–∏

## HISTORY:

* v2.0.0 (2025-06-12): –§–æ–∫—É—Å —Å–º–µ—â–µ–Ω –Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∞–π—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤.
* v1.0.0 (2025-06-10): –ù–∞—á–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è, —Ñ–æ–∫—É—Å –Ω–∞ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤.

## 1. –ù–µ–¥–∞–≤–Ω–∏–µ –∫–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω—ã:**
- –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –ø–æ–¥ –ø–æ–Ω—è—Ç–∏–µ–º "–ê—Ä—Ç–µ—Ñ–∞–∫—Ç" 
- –î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ AI –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- Redis clipboard —Å –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º –∫–∞–∫ —É —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞

**–ù–µ–¥–∞–≤–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (2025-06-14):**
- –ò–∑–º–µ–Ω–µ–Ω–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ Redis –±—É—Ñ–µ—Ä–∞: `getAndClearArtifactFromClipboard` ‚Üí `getArtifactFromClipboard` + `clearArtifactFromClipboard`
- –¢–µ–ø–µ—Ä—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç –º–æ–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑–Ω—ã—Ö —á–∞—Ç–æ–≤ (–∫–∞–∫ —Å–∏—Å—Ç–µ–º–Ω—ã–π –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞)
- –†—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –±—É—Ñ–µ—Ä–∞ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –æ—Ç–º–µ–Ω—ã –≤ UI
- **–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤:** –£—Å—Ç—Ä–∞–Ω–µ–Ω–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∞—è —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è "document" –≤ –ø–æ–ª—å–∑—É "artifact"
  - `document-skeleton.tsx` ‚Üí `artifact-skeleton.tsx` 
  - `document.tsx` ‚Üí `artifact-tool-results.tsx`
  - –£–¥–∞–ª–µ–Ω —É—Å—Ç–∞—Ä–µ–≤—à–∏–π API `/api/chat/discuss-artifact/` (–∑–∞–º–µ–Ω–µ–Ω Redis clipboard)

## 2. –¢–µ–∫—É—â–∏–π —Ñ–æ–∫—É—Å

**–û—Å–Ω–æ–≤–Ω–∞—è –§–∞–∑–∞ 2 –ó–ê–í–ï–†–®–ï–ù–ê:** –í—Å—è –∫–ª—é—á–µ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∞–π—Ç–æ–≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç.

**–§–∞–∑–∞ 3 –ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–í–ï–†–®–ï–ù–ê:** –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Ä–µ—à–µ–Ω—ã, –≤—Å–µ route —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (71/71). 

**‚úÖ –†–ï–®–ï–ù–´ –í–°–ï –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–®–ï–ù–ê –ø—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ—Ä—Ç–∞–º–∏!** Async config Playwright'–∞ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `PLAYWRIGHT_PORT` –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- ‚úÖ –ù–µ—Ç –±–æ–ª—å—à–µ –≤–∏—Å—è—á–∏—Ö —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –ø–æ—Ä—Ç–∞—Ö
- ‚úÖ **–†–ï–®–ï–ù–ê –ü–†–û–ë–õ–ï–ú–ê –° –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–ï–ô!** –°–æ–∑–¥–∞–Ω custom test auth middleware, –æ–±—Ö–æ–¥—è—â–∏–π Auth.js v5 —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
- ‚úÖ **–†–ï–®–ï–ù–ê –ü–†–û–ë–õ–ï–ú–ê –° UUID!** PostgreSQL —Ç—Ä–µ–±—É–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–π UUID, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Å `"test-user-id"` –Ω–∞ `"00000000-0000-0000-0000-000000000000"`
- ‚úÖ API route —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ —Å –Ω–æ–≤—ã–º –ø–æ–¥—Ö–æ–¥–æ–º (9/9 artifacts —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—à–ª–∏)
- ‚úÖ –£–±—Ä–∞–Ω–æ debug –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø—Ä–æ–≤–µ–¥–µ–Ω—ã lint + typecheck

**–û–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (2025-06-15, 20:44):**
- ‚úÖ **files-upload.test.ts** - –ò–°–ü–†–ê–í–õ–ï–ù–ê –õ–û–ì–ò–ö–ê: —Ç–µ—Å—Ç –æ–∂–∏–¥–∞–ª –æ—à–∏–±–∫—É 400/500, –Ω–æ –≤ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥–µ API –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200 (–∑–∞–≥–ª—É—à–µ–Ω)
- ‚úÖ **redis-clipboard.test.ts** - –ò–°–ü–†–ê–í–õ–ï–ù–ê JSON-–ø–∞—Ä—Å–∏–Ω–≥ –ø—Ä–æ–±–ª–µ–º–∞: Drizzle –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–∞—Ä—Å–∏—Ç JSON –∏–∑ –ë–î
- ‚úÖ **artifact.test.ts: 9/9 passed (49.6s)** - –û–ö–û–ù–ß–ê–¢–ï–õ–¨–ù–û –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ
- ‚úÖ **–í—Å–µ route —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç: 71/71** - —Å–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

**‚úÖ –†–ï–§–ê–ö–¢–û–†–ò–ù–ì MEMORY BANK –ó–ê–í–ï–†–®–ï–ù (2025-06-16):**

üéâ **AI-Unified Recall Architecture —É—Å–ø–µ—à–Ω–æ –≤–Ω–µ–¥—Ä–µ–Ω–∞:**

**‚úÖ –í–´–ü–û–õ–ù–ï–ù–ù–ê–Ø –†–ï–°–¢–†–£–ö–¢–£–†–ò–ó–ê–¶–ò–Ø:**
1. **–ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫** - guides/, architecture/, testing/ –¥–ª—è –ª–æ–≥–∏—á–µ—Å–∫–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
2. **–ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª README.md** - –∞–Ω–Ω–æ—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ –≤–º–µ—Å—Ç–æ MEMORY-BANK.md
3. **–û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞** - product-guide.md, coding-standards.md –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
4. **Kanban —Å–∏—Å—Ç–µ–º–∞ –∑–∞–¥–∞—á** - backlog.md –≤–º–µ—Å—Ç–æ –∂–µ—Å—Ç–∫–æ–π —Å–∏—Å—Ç–µ–º—ã –§–∞–∑–∞‚Üí–®–∞–≥‚Üí–ó–∞–¥–∞—á–∞
5. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –≤—Å–µ testing –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤ –æ–¥–Ω–æ–π –ø–∞–ø–∫–µ
6. **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π CLAUDE.md** - @-—Å—Å—ã–ª–∫–∏ –Ω–∞ –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É

**‚úÖ –†–ï–§–ê–ö–¢–û–†–ò–ù–ì "SPARSE COLUMNS" –ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–í–ï–†–®–ï–ù (2025-06-16):**

üéâ **–ú–∞—Å—à—Ç–∞–±–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã —Ö—Ä–∞–Ω–µ–Ω–∏—è –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω:**

**‚úÖ –í–´–ü–û–õ–ù–ï–ù–ù–´–ô –†–ï–§–ê–ö–¢–û–†–ò–ù–ì:**
1. **–°—Ö–µ–º–∞ –ë–î –æ–±–Ω–æ–≤–ª–µ–Ω–∞** - –∑–∞–º–µ–Ω–µ–Ω–∞ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞ `content` –Ω–∞ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ:
   - `content_text: text` –¥–ª—è text/code/sheet –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
   - `content_url: varchar(2048)` –¥–ª—è image –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤  
   - `content_site_definition: jsonb` –¥–ª—è site –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
2. **–°–æ–∑–¥–∞–Ω—ã —É—Ç–∏–ª–∏—Ç—ã** - `lib/artifact-content-utils.ts` —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ `getDisplayContent()`, `prepareContentForSave()`, `normalizeArtifactForAPI()`
3. **API –æ–±–Ω–æ–≤–ª–µ–Ω—ã** - –≤—Å–µ endpoints –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω—ã —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
4. **UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω—ã** - –∏—Å–ø–æ–ª—å–∑—É—é—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π API
5. **AI tools –æ–±–Ω–æ–≤–ª–µ–Ω—ã** - —Ä–∞–±–æ—Ç–∞—é—Ç —Å –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –¥–∞–Ω–Ω—ã—Ö
6. **Site-blocks –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω—ã** - –ø–æ–ª—É—á–∞—é—Ç –∫–æ–Ω—Ç–µ–Ω—Ç —á–µ—Ä–µ–∑ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π API
7. **–¢–µ—Å—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã** - –≤—Å–µ mock –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏

**‚úÖ –ö–ê–ß–ï–°–¢–í–û –ö–û–î–ê –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û:**
- ‚úÖ TypeScript –∫–æ–º–ø–∏–ª—è—Ü–∏—è: `pnpm run typecheck` –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ ESLint –ø—Ä–æ–≤–µ—Ä–∫–∞: `next lint --quiet` –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π  
- ‚úÖ –í—Å–µ —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –ø–æ–¥ –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
- ‚úÖ API —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–ª–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- ‚úÖ Debug –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫

**üéØ –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê:** 
- –ü–æ–≤—ã—à–µ–Ω–∞ —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- –£–ª—É—á—à–µ–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î
- –£–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –ø–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º API

### API –ê—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏:**
- API endpoints –¥–æ—Å—Ç—É–ø–Ω—ã —Å –æ–±–µ–∏—Ö –¥–æ–º–µ–Ω–æ–≤ (localhost –∏ app.localhost)
- middleware.ts –∏—Å–∫–ª—é—á–∞–µ—Ç API routes –∏–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ–º–µ–Ω–æ–≤
- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã: `/api/artifacts/*` —Ä–∞–±–æ—Ç–∞—é—Ç –≤–µ–∑–¥–µ

**–ö–ª—é—á–µ–≤—ã–µ endpoints:**
- `GET /api/artifacts/recent` - –ø–æ–ª—É—á–µ–Ω–∏–µ –Ω–µ–¥–∞–≤–Ω–∏—Ö –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
- `POST /api/artifacts` - —Å–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤  
- `GET /api/artifacts/[id]` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:**
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∞–∫ –æ–±—ã—á–Ω—É—é NextAuth session, —Ç–∞–∫ –∏ test-session
- Fallback –Ω–∞ getTestSession() –µ—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–∞—è —Å–µ—Å—Å–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ session.user.id –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞

**Troubleshooting –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ data-testid="artifact" –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
2. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
4. "–ë–∏—Ç—ã–µ —Å—Å—ã–ª–∫–∏" –æ–±—ã—á–Ω–æ –æ–∑–Ω–∞—á–∞—é—Ç UX –æ–∂–∏–¥–∞–Ω–∏—è, –∞ –Ω–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –ø—Ä–æ–±–ª–µ–º—É

**–ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –ò–ù–°–ê–ô–¢–´:**
- –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ - –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∏ –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ —Å—Å—ã–ª–∫–∏
- Foreign key constraints —Ç—Ä–µ–±—É—é—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –ë–î –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º —á–∞—Ç–æ–≤
- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–æ–ª–∂–Ω–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç—å –Ω–∞ –Ω–æ–≤—ã–π —á–∞—Ç, –∞ –Ω–µ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å Chat –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–∞–ø—Ä—è–º—É—é

**–ù–µ–¥–∞–≤–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (2025-06-16):**
- ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–ê –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê:** –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–π `await` –≤ `getChatsByUserId()` (lib/db/queries.ts:144)
- ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–ê –õ–û–ì–ò–ö–ê –†–û–£–¢–ò–ù–ì–ê:** –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–µ–ø–µ—Ä—å –¥–µ–ª–∞–µ—Ç redirect –Ω–∞ –Ω–æ–≤—ã–π —á–∞—Ç
- ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–ê 404 –î–õ–Ø –ù–û–í–´–• –ß–ê–¢–û–í:** –°—Ç—Ä–∞–Ω–∏—Ü–∞ —á–∞—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —á–∞—Ç–æ–≤
- ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–ê –¢–ï–°–¢–û–í–ê–Ø –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø:** FK constraints –≤ API create-user

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ data-testid (2025-06-16):**
- ‚úÖ **–°–û–ó–î–ê–ù–ê –ò–ï–†–ê–†–•–ò–ß–ï–°–ö–ê–Ø –°–ò–°–¢–ï–ú–ê:** –ü—Ä–µ—Ñ–∏–∫—Å—ã –ø–æ –∑–æ–Ω–∞–º UI (header-, chat-input-, artifact-, sidebar-)
- ‚úÖ **–î–û–ë–ê–í–õ–ï–ù–´ TESTID –í –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´:**
  - Header: `header-new-chat-button`, `header-share-button`, `header-theme-selector`, `header-user-menu`
  - ChatInput: `chat-input-textarea`, `chat-input-send-button`, `chat-input-attach-menu`, `chat-input-model-selector`
  - Artifacts: `artifact-panel-close-button`, `artifact-actions-add-to-chat-button`, `artifact-actions-discuss-button`
- ‚úÖ **–°–û–ó–î–ê–ù–´ UI –•–ï–õ–ü–ï–†–´:** `tests/helpers/ui-helpers.ts` —Å –∫–ª–∞—Å—Å–∞–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –∑–æ–Ω—ã UI
- ‚úÖ **–°–û–ó–î–ê–ù DEMO –¢–ï–°–¢:** `tests/e2e/ui-helpers-demo.test.ts` —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- ‚úÖ **–û–ë–ù–û–í–õ–ï–ù–ê –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø:** `.memory-bank/docs/ui-interface-structure.md` —Å –ø–æ–ª–Ω—ã–º mapping —ç–ª–µ–º–µ–Ω—Ç–æ–≤ ‚Üí –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ ‚Üí testid

**‚úÖ –ö–û–ú–ü–õ–ï–ö–°–ù–û–ï –õ–û–ì–ò–†–û–í–ê–ù–ò–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–û (2025-06-16):**

üéâ **–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ–π –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç–∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ —É—Å–ø–µ—à–Ω–æ –≤–Ω–µ–¥—Ä–µ–Ω–∞:**

**‚úÖ –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø:**
1. **Enhanced –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö** - –¥–æ–±–∞–≤–ª–µ–Ω—ã –∫–ª—é—á–µ–≤—ã–µ —Ç–æ—á–∫–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:
   - `text/server.ts:52` - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è AI –º–æ–¥–µ–ª–∏
   - `sheet/server.ts:67` - –ª–æ–≥ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ –ë–î
2. **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–î –æ–ø–µ—Ä–∞—Ü–∏–π** - `lib/db/queries.ts:220-280`:
   - –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è sparse columns —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ü–µ–ª–µ–≤—ã—Ö –∫–æ–ª–æ–Ω–æ–∫
   - –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–Ω—Ç–µ–Ω—Ç–µ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
   - –õ–æ–≥–∏ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å ID –∏ —Ç–∏–ø–æ–º –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞
   - –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å stack traces
3. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–∫-—Å–∏—Å—Ç–µ–º—ã** - —É–¥–∞–ª–µ–Ω –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π `doStreamObject` –∏–∑ `lib/ai/models.test.ts`
4. **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ**:
   - ‚úÖ TypeScript: `pnpm typecheck` –ø—Ä–æ—Ö–æ–¥–∏—Ç
   - ‚úÖ ESLint: `next lint` –ø—Ä–æ—Ö–æ–¥–∏—Ç  
   - ‚úÖ –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã: 12/12 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç

**üéØ –ö–õ–Æ–ß–ï–í–û–ï –û–¢–ö–†–´–¢–ò–ï:**
- Sparse columns –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —É–∂–µ –±—ã–ª–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- –†–µ–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ –º–æ–∫-—Å–∏—Å—Ç–µ–º–µ AI (`doStreamObject` –º–µ—Ç–æ–¥)
- –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–ø–µ—Ä—å –∏—Å–∫–ª—é—á–∞–µ—Ç "—Ç–∏—Ö–∏–µ" –æ—Ç–∫–∞–∑—ã

**üîç –†–ï–ó–£–õ–¨–¢–ê–¢:**
–ü–æ–ª–Ω–∞—è –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ - –ª—é–±–∞—è –æ—à–∏–±–∫–∞ –±—É–¥–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ç–æ—á–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –∏ –ø—Ä–∏—á–∏–Ω—ã —Å–±–æ—è.

**üî• –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê AI –ó–ê–í–ò–°–ê–ù–ò–Ø –†–ï–®–ï–ù–ê (2025-06-16):**

üéâ **–§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞ –≤ timeout –ª–æ–≥–∏–∫–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞:**

**‚úÖ –ö–û–†–ù–ï–í–ê–Ø –ü–†–ò–ß–ò–ù–ê –û–ë–ù–ê–†–£–ñ–ï–ù–ê:**
- **–°–µ—Ä—å–µ–∑–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –æ—à–∏–±–∫–∞** - Promise.race –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞–ª –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π `streamObject()` –≤—ã–∑–æ–≤
- **–†–µ–∞–ª—å–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ** `await object` –æ—Å—Ç–∞–≤–∞–ª–æ—Å—å –Ω–µ–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–º 
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** "–¢–∏—Ö–∏–µ –∑–∞–≤–∏—Å–∞–Ω–∏—è" –Ω–∞ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ sheet –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤

**‚úÖ –¢–ï–•–ù–ò–ß–ï–°–ö–û–ï –†–ï–®–ï–ù–ò–ï:**
- **–î–æ:** `Promise.race([streamObjectPromise, timeoutPromise])` - timeout –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω
- **–ü–æ—Å–ª–µ:** `Promise.race([resultPromise.object, timeoutPromise])` - timeout –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ
- **–¢–∞–π–º–∞—É—Ç:** —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ 30 —Å–µ–∫—É–Ω–¥ (–ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- **–§–∞–π–ª:** `artifacts/kinds/sheet/server.ts:68-71`

**‚úÖ –ö–ê–ß–ï–°–¢–í–û –†–ï–®–ï–ù–ò–Ø:**
- ‚úÖ TypeScript: `pnpm typecheck` ‚úÖ
- ‚úÖ ESLint: `next lint --quiet` ‚úÖ  
- ‚úÖ –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã: 12/12 passed ‚úÖ

**üéØ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –†–ï–ó–£–õ–¨–¢–ê–¢:**
–°–∏—Å—Ç–µ–º–∞ –±–æ–ª—å—à–µ –ù–ï –∑–∞–≤–∏—Å–∞–µ—Ç –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤. –õ—é–±—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å AI API —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Å —Ç–∞–π–º–∞—É—Ç–æ–º 30 —Å–µ–∫—É–Ω–¥.

**üöÄ –ö–û–ú–ü–õ–ï–ö–°–ù–û–ï –†–ï–®–ï–ù–ò–ï "–¢–ò–•–û–ì–û –ó–ê–í–ò–°–ê–ù–ò–Ø" –ó–ê–í–ï–†–®–ï–ù–û (2025-06-16):**

üéâ **–î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ —É—Å–ø–µ—à–Ω–æ –≤–Ω–µ–¥—Ä–µ–Ω–∞:**

**‚úÖ –ö–û–†–ù–ï–í–ê–Ø –ü–†–ò–ß–ò–ù–ê –ü–û–õ–ù–û–°–¢–¨–Æ –£–°–¢–†–ê–ù–ï–ù–ê:**
- **Vercel platform timeout** - API —Ñ—É–Ω–∫—Ü–∏–∏ "—É–º–∏—Ä–∞–ª–∏" —á–µ—Ä–µ–∑ 10-15 —Å–µ–∫—É–Ω–¥
- **Gemini AI –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** - –º–æ–¥–µ–ª—å "–∑–∞–¥—É–º—ã–≤–∞–ª–∞—Å—å" –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ JSON –ø–æ —Å—Ö–µ–º–µ
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–æ–º–±–∏–Ω–∞—Ü–∏—è —Ñ–∞–∫—Ç–æ—Ä–æ–≤ –≤—ã–∑—ã–≤–∞–ª–∞ –ø–æ–ª–Ω—ã–µ "—Ç–∏—Ö–∏–µ –∑–∞–≤–∏—Å–∞–Ω–∏—è"

**‚úÖ –î–í–£–•–§–ê–ö–¢–û–†–ù–û–ï –†–ï–®–ï–ù–ò–ï:**
- **–§–∞–∫—Ç–æ—Ä 1: Platform timeout** 
  - `maxDuration = 60` –≤ `/api/chat/route.ts:52` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è
  - –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç "—É–±–∏–π—Å—Ç–≤–æ" –ø—Ä–æ—Ü–µ—Å—Å–∞ Vercel
- **–§–∞–∫—Ç–æ—Ä 2: AI —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è**
  - `mode: 'tool'` –≤ streamObject –≤—ã–∑–æ–≤–∞—Ö –ø—Ä–∏–Ω—É–∂–¥–∞–µ—Ç Gemini –∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
  - –£—Å–∏–ª–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç —Å —á–µ—Ç–∫–∏–º–∏ JSON schema –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏

**‚úÖ –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø:**
- **artifacts/kinds/sheet/server.ts:58** - `mode: 'tool'` –¥–ª—è create –æ–ø–µ—Ä–∞—Ü–∏–∏  
- **artifacts/kinds/sheet/server.ts:148** - `mode: 'tool'` –¥–ª—è update –æ–ø–µ—Ä–∞—Ü–∏–∏
- **lib/ai/prompts.ts:179-184** - –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ JSON –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

**‚úÖ –ö–ê–ß–ï–°–¢–í–û –†–ï–®–ï–ù–ò–Ø:**
- ‚úÖ TypeScript: `pnpm typecheck` ‚úÖ
- ‚úÖ ESLint: `next lint --quiet` ‚úÖ  
- ‚úÖ –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã: 12/12 passed ‚úÖ

**üéØ –§–ò–ù–ê–õ–¨–ù–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢:**
–ü–æ–ª–Ω–æ–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ "—Ç–∏—Ö–∏—Ö –∑–∞–≤–∏—Å–∞–Ω–∏–π" –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ sheet –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤. –°–∏—Å—Ç–µ–º–∞ –∏–º–µ–µ—Ç –¥–≤–æ–π–Ω—É—é –∑–∞—â–∏—Ç—É –æ—Ç timeout –ø—Ä–æ–±–ª–µ–º –∫–∞–∫ –Ω–∞ platform, —Ç–∞–∫ –∏ –Ω–∞ AI —É—Ä–æ–≤–Ω–µ.

**üîç –î–ï–¢–ê–õ–¨–ù–ê–Ø –û–¢–õ–ê–î–ö–ê AI –ü–†–û–ú–ü–¢–û–í –î–û–ë–ê–í–õ–ï–ù–ê (2025-06-16):**

üéâ **–ü–æ–ª–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å AI –≤—ã–∑–æ–≤–æ–≤ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:**

**‚úÖ –†–ê–°–®–ò–†–ï–ù–ù–û–ï –õ–û–ì–ò–†–û–í–ê–ù–ò–ï:**
- **artifacts/kinds/sheet/server.ts:41-44** - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ system/user –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è create –æ–ø–µ—Ä–∞—Ü–∏–π
- **artifacts/kinds/sheet/server.ts:141-144** - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ system/user –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è update –æ–ø–µ—Ä–∞—Ü–∏–π
- **–§–æ—Ä–º–∞—Ç:** `childLogger.info({ systemPrompt, userPrompt }, 'Final prompts for Google Gemini API call')`

**‚úÖ –ü–û–î–î–ï–†–ñ–ö–ê GOOGLE AI STUDIO –û–¢–õ–ê–î–ö–ò:**
- –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ç–µ–ø–µ—Ä—å –º–æ–≥—É—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–æ—á–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –∏–∑ –ª–æ–≥–æ–≤
- –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤ AI Studio –¥–ª—è —Ä—É—á–Ω–æ–π –æ—Ç–ª–∞–¥–∫–∏
- –ü–æ–ª–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å —Ç–æ–≥–æ, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ Gemini API

**‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ê RUNTIME –ü–†–û–ë–õ–ï–ú–ê –° ZOD –í–ê–õ–ò–î–ê–¶–ò–ï–ô:**
- **–ü—Ä–æ–±–ª–µ–º–∞:** selectedChatModel –∏ selectedVisibilityType –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞–ª–∏—Å—å –≤ API –∑–∞–ø—Ä–æ—Å–∞—Ö
- **–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:** useChat —Ö—É–∫ –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞–ª –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –∏–∑ ChatInput
- **–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –ø–æ–ª—è –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é useChat (body: { selectedChatModel, selectedVisibilityType })
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞—é—Ç—Å—è –≤–æ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã

**‚úÖ –ö–ê–ß–ï–°–¢–í–û –°–ò–°–¢–ï–ú–´:**
- ‚úÖ TypeScript: `pnpm typecheck` ‚úÖ
- ‚úÖ ESLint: `next lint --quiet` ‚úÖ  
- ‚úÖ –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã: 12/12 passed ‚úÖ

**üéØ –¢–ï–ö–£–©–ò–ô –°–¢–ê–¢–£–°:**
–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è sheet –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ - –ø–µ—Ä–µ—Ö–æ–¥ —Å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π JSON –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–∞ –ø—Ä–æ—Å—Ç—É—é —Ç–µ–∫—Å—Ç–æ–≤—É—é –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –∑–∞–≤–∏—Å–∞–Ω–∏–π.

**–û—Å—Ç–∞–≤—à–∏–µ—Å—è –∑–∞–¥–∞—á–∏ (–Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç):**
- –î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ data-testid –∞—Ç—Ä–∏–±—É—Ç—ã –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–ø–æ —Å–ø–∏—Å–∫—É –≤—ã—à–µ)
- E2E —Ç–µ—Å—Ç—ã –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã –∏–∑-–∑–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤ AI workflow (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

## 3. –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –∏ –ø–ª–∞–Ω —Ä–∞–±–æ—Ç

**üéâ –í–°–ï –ó–ê–î–ê–ß–ò –ü–û–õ–ù–û–°–¢–¨–Æ –í–´–ü–û–õ–ù–ï–ù–´!**

**‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –Ω–æ–≤—ã—Ö —Ñ–∏—á**

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å –ø–æ—Ä—Ç–∞–º–∏ –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π** 
- ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–®–ï–ù–û:** Async config Playwright'–∞ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `PLAYWRIGHT_PORT`
- ‚úÖ **–ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û:** –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ, –Ω–µ—Ç –≤–∏—Å—è—á–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –ø–æ—Ä—Ç–∞—Ö
- ‚úÖ **–†–ï–®–ï–ù–û:** –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–µ—Ä–µ–¥–∞—á–µ–π cookies –º–µ–∂–¥—É browser –∏ API contexts –≤ Playwright  
- ‚úÖ **–†–ï–®–ï–ù–û:** –°–æ–∑–¥–∞–Ω custom test auth middleware, –æ–±—Ö–æ–¥—è—â–∏–π Auth.js v5 –ø—Ä–æ–±–ª–µ–º—ã
- ‚úÖ **–†–ï–®–ï–ù–û:** PostgreSQL UUID –ø—Ä–æ–±–ª–µ–º–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞
- ‚úÖ **–ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û:** API route —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ (71/71 –ø—Ä–æ—Ö–æ–¥—è—Ç)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –ü–æ–∫—Ä—ã—Ç–∏–µ Redis –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**
- ‚úÖ **–°–û–ó–î–ê–ù–û:** –¢–µ—Å—Ç—ã –¥–ª—è `copyArtifactToClipboard` / `getArtifactFromClipboard` + `clearArtifactFromClipboard`
- ‚úÖ **–ü–û–ö–†–´–¢–û:** –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å Redis clipboard

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è**
- ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–´:** –í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –≤ route —Ç–µ—Å—Ç–∞—Ö
- ‚úÖ **–†–ï–®–ï–ù–´:** Drizzle JSON –∞–≤—Ç–æ–ø–∞—Ä—Å–∏–Ω–≥ –∏ —Ç–µ—Å—Ç–æ–≤–∞—è —Å—Ä–µ–¥–∞ –ª–æ–≥–∏–∫–∞
- ‚úÖ **–†–ï–ó–£–õ–¨–¢–ê–¢:** 71/71 route —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ

**‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4: E2E –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ - –ß–ê–°–¢–ò–ß–ù–û –í–´–ü–û–õ–ù–ï–ù–û**

**üéØ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ò–ù–°–ê–ô–¢:** –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å E2E —Ç–µ—Å—Ç–∞–º–∏ –ø–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –º—É–ª—å—Ç–∏-–¥–æ–º–µ–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.

**‚úÖ –†–∞–±–æ—Ç–∞—é—â–∏–µ E2E —Ç–µ—Å—Ç—ã (–∏—Å–ø–æ–ª—å–∑—É—é—Ç test auth):**
- ‚úÖ **simple-test.test.ts** (1/1 passed, 37.3s) - –±–∞–∑–æ–≤–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ test auth
- ‚úÖ **basic-chat.test.ts** (2/2 passed, 52.1s) - —á–∞—Ç —Å test auth system
- ‚úÖ **auth-test.test.ts** (1/1 passed, 26.3s) - –ø—Ä—è–º–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ test auth API

**‚ùå –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ E2E —Ç–µ—Å—Ç—ã (–∏—Å–ø–æ–ª—å–∑—É—é—Ç Auth.js):**  
- ‚ùå **session.test.ts** - hardcoded –ø–æ—Ä—Ç—ã (3000 vs –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π 3004), –º—É–ª—å—Ç–∏-–¥–æ–º–µ–Ω–Ω—ã–µ redirect –ø—Ä–æ–±–ª–µ–º—ã
- ‚ùå **chat.test.ts** - –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ chat-input (redirect –Ω–∞ login –±–µ–∑ auth)
- ‚ùå **artifacts.test.ts** - –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
- ‚ö†Ô∏è **ai-first-workflow.test.ts** - —á–∞—Å—Ç–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω—ã–π (Auth.js + test auth mix)

**üî• –ö–õ–Æ–ß–ï–í–ê–Ø –ü–†–û–ë–õ–ï–ú–ê:** –°—Ç–∞—Ä—ã–µ E2E —Ç–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –Ω–∞—Å—Ç–æ—è—â–∏–π Auth.js flow (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/login), –∫–æ—Ç–æ—Ä—ã–π –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º —Å –º—É–ª—å—Ç–∏-–¥–æ–º–µ–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π (app.localhost vs localhost redirect loops).

## 4. –í–∞–∂–Ω—ã–µ –∏–Ω—Å–∞–π—Ç—ã –∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

-   **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å ‚Äî –∫–ª—é—á:** –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ "–ø–ª–∞–≥–∏–Ω–æ–≤" –¥–ª—è –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –∏ –±–ª–æ–∫–æ–≤ —Å–∞–π—Ç–∞ –ø–æ–∑–≤–æ–ª–∏—Ç –Ω–∞–º –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å —Å–∏—Å—Ç–µ–º—É –≤ –±—É–¥—É—â–µ–º.
-   **–ò–∑–æ–ª—è—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:** –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∞–π—Ç–∞ –≤ `site-blocks/` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –∏ –Ω–µ –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —Ç–æ–ª—å–∫–æ –æ—Ç API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.
-   **JSON –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã:** `SiteDefinition` (JSON –≤ –ø–æ–ª–µ `content` –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞-—Å–∞–π—Ç–∞) —è–≤–ª—è–µ—Ç—Å—è –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –ø—Ä–∞–≤–¥—ã –æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

## 5. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—Ä–æ–∫–∏ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é (2025-06-15)

**üî• –ù–ï–û–ß–ï–í–ò–î–ù–û–ï –¥–ª—è AI –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:**

1. **Auth.js v5 + PostgreSQL + Playwright = –ø—Ä–æ–±–ª–µ–º–∞:**
   - Auth.js v5 –Ω–µ —Å–æ–∑–¥–∞–µ—Ç session tokens –≤ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥–µ
   - PostgreSQL —Ç—Ä–µ–±—É–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–π UUID —Ñ–æ—Ä–º–∞—Ç –¥–ª—è user_id
   - –†–µ—à–µ–Ω–∏–µ: custom test auth middleware —Å –≤–∞–ª–∏–¥–Ω—ã–º UUID

2. **Playwright async config –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑:**
   - –ö–∞–∂–¥—ã–π —Ä–∞–∑ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π –ø–æ—Ä—Ç
   - –†–µ—à–µ–Ω–∏–µ: `PLAYWRIGHT_PORT` environment variable –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏

3. **–ú—É–ª—å—Ç–∏-–¥–æ–º–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - Cookies –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –º–µ–∂–¥—É `app.localhost` –∏ `localhost` 
   - –†–µ—à–µ–Ω–∏–µ: —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞ –æ–¥–Ω–æ–º –¥–æ–º–µ–Ω–µ –≤ —Ç–µ—Å—Ç–∞—Ö

4. **–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ä–µ–¥–∞ vs Production API –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
   - API –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞–≥–ª—É—à–µ–Ω—ã –≤ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, files/upload)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ `X-Test-Environment === 'playwright'` –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ
   - –†–µ—à–µ–Ω–∏–µ: —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã —É—á–∏—Ç—ã–≤–∞—Ç—å –∑–∞–≥–ª—É—à–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã

5. **Drizzle ORM JSON –∞–≤—Ç–æ–ø–∞—Ä—Å–∏–Ω–≥:**
   - –ü–æ–ª–µ `json('content').$type<string>()` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–∞—Ä—Å–∏—Ç JSON –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –∏–∑ –ë–î
   - –õ–∏—à–Ω–∏–π `JSON.parse()` –≤ —Ç–µ—Å—Ç–∞—Ö –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏
   - –†–µ—à–µ–Ω–∏–µ: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–∞–ø—Ä—è–º—É—é –∫–∞–∫ –æ–±—ä–µ–∫—Ç

6. **–ú—É–ª—å—Ç–∏-–¥–æ–º–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ vs E2E —Ç–µ—Å—Ç—ã (2025-06-15):**
   - Auth.js redirect'—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –º–µ–∂–¥—É app.localhost –∏ localhost
   - –°—Ç–∞—Ä—ã–µ E2E —Ç–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –Ω–∞—Å—Ç–æ—è—â–∏–π Auth.js flow, –∫–æ—Ç–æ—Ä—ã–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç
   - –†–µ—à–µ–Ω–∏–µ: –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ E2E —Ç–µ—Å—Ç—ã –Ω–∞ test auth —Å–∏—Å—Ç–µ–º—É

**üí° –ü–ê–¢–¢–ï–†–ù –†–ï–®–ï–ù–ò–Ø –¥–ª—è Auth –≤ —Ç–µ—Å—Ç–∞—Ö:**
- `/api/test/auth-signin` —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ—Å—Ç–æ–π JSON session cookie
- `lib/test-auth.ts` —á–∏—Ç–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ sessions
- –í—Å–µ API routes –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç dual auth: `auth()` fallback –Ω–∞ `getTestSession()`
- –ö—Ä–∏—Ç–∏—á–Ω–æ: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–∞–ª–∏–¥–Ω—ã–π UUID –¥–ª—è PostgreSQL

**üí° –ü–ê–¢–¢–ï–†–ù –†–ï–®–ï–ù–ò–Ø –¥–ª—è E2E —Ç–µ—Å—Ç–æ–≤:**
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ test auth —Å–∏—Å—Ç–µ–º—É (simple-test, basic-chat, auth-test)
- ‚ùå **–ò–∑–±–µ–≥–∞—Ç—å:** –ù–∞—Å—Ç–æ—è—â–∏–π Auth.js flow –≤ E2E —Ç–µ—Å—Ç–∞—Ö (–º–µ–¥–ª–µ–Ω–Ω–æ, –ø—Ä–æ–±–ª–µ–º—ã —Å redirect'–∞–º–∏)
- üîß **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** `tests/helpers/test-config.ts` –¥–ª—è –ø–æ—Ä—Ç–æ–≤/–¥–æ–º–µ–Ω–æ–≤
- üìê **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ URL:** –ù–∏–∫–æ–≥–¥–∞ –Ω–µ hardcode –ø–æ—Ä—Ç—ã –≤ —Ç–µ—Å—Ç–∞—Ö

**üí° –ü–ê–¢–¢–ï–†–ù –†–ï–®–ï–ù–ò–Ø –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã:**
- –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ API –≤ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥–µ vs production
- –£—á–∏—Ç—ã–≤–∞—Ç—å –∑–∞–≥–ª—É—à–∫–∏ –∏ –∞–≤—Ç–æ–ø–∞—Ä—Å–∏–Ω–≥ –≤ —Ç–µ—Å—Ç–∞—Ö
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è –≤ —Ç–µ—Å—Ç–∞—Ö

7. **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–∫: "Sparse Columns —É–∂–µ —Ä–∞–±–æ—Ç–∞–ª–∏" (2025-06-16):**
   - –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ sparse columns –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –±—ã–ª –ü–†–ê–í–ò–õ–¨–ù–û —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
   - –ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –ù–ï –≤ –ë–î —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏, –∞ –≤ –º–æ–∫-—Å–∏—Å—Ç–µ–º–µ AI
   - `doStreamObject` –º–µ—Ç–æ–¥ –≤ `lib/ai/models.test.ts` –±—ã–ª –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º (–Ω–µ –≤—Ö–æ–¥–∏—Ç –≤ official interface)
   - –†–µ—à–µ–Ω–∏–µ: —É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ mock –º–µ—Ç–æ–¥–∞ –∏—Å–ø—Ä–∞–≤–∏–ª–æ TypeScript –æ—à–∏–±–∫–∏

8. **–í–∞–∂–Ω–æ—Å—Ç—å –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (2025-06-16):**
   - "–¢–∏—Ö–∏–µ" –æ—Ç–∫–∞–∑—ã –º–∞—Å–∫–∏—Ä—É—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
   - –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ pipeline –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏  
   - –û—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å sparse columns –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ü–µ–ª–µ–≤—ã—Ö –∫–æ–ª–æ–Ω–æ–∫
   - Stack traces –≤ error logs —É—Å–∫–æ—Ä—è—é—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –≤ —Ä–∞–∑—ã

**üí° –ü–ê–¢–¢–ï–†–ù –†–ï–®–ï–ù–ò–Ø –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ "–∑–∞–≤–∏—Å–∞—é—â–∏—Ö" –æ–ø–µ—Ä–∞—Ü–∏–π:**
- ‚úÖ **–®–∞–≥ 1:** –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –ö–ê–ñ–î–û–ú —ç—Ç–∞–ø–µ pipeline
- ‚úÖ **–®–∞–≥ 2:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å mock/test —Å–∏—Å—Ç–µ–º—ã –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å
- ‚úÖ **–®–∞–≥ 3:** –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ TypeScript –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Å–æ–±–ª—é–¥–∞—é—Ç—Å—è
- ‚ùå **–ò–∑–±–µ–≥–∞—Ç—å:** –ü—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–π –æ —Ç–æ–º, –≥–¥–µ –ø—Ä–æ–±–ª–µ–º–∞ - –ª–æ–≥–∏ –ø–æ–∫–∞–∂—É—Ç –ø—Ä–∞–≤–¥—É
- üîß **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:** `@fab33/fab-logger` –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

**üí° –ü–ê–¢–¢–ï–†–ù –†–ï–®–ï–ù–ò–Ø –¥–ª—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
- –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —á—Ç–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —É–∂–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π
- Mock-—Å–∏—Å—Ç–µ–º—ã –º–æ–≥—É—Ç –±—ã—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –ø—Ä–æ–±–ª–µ–º –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- TypeScript –æ—à–∏–±–∫–∏ —á–∞—Å—Ç–æ —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º

9. **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô —É—Ä–æ–∫: Promise.race timeout patterns (2025-06-16):**
   - **–°–µ—Ä—å–µ–∑–Ω–∞—è –æ—à–∏–±–∫–∞** - timeout –Ω–∞ –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã (`streamObject()`) –±–µ—Å–ø–æ–ª–µ–∑–µ–Ω
   - **–ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–æ–¥—Ö–æ–¥** - timeout –¥–æ–ª–∂–µ–Ω –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ (`await object`)
   - **–°–∏–º–ø—Ç–æ–º** - "—Ç–∏—Ö–∏–µ –∑–∞–≤–∏—Å–∞–Ω–∏—è" –±–µ–∑ –æ—à–∏–±–æ–∫ –∏ —Ç–∞–π–º–∞—É—Ç–æ–≤
   - **–†–µ—à–µ–Ω–∏–µ** - `Promise.race([resultPromise.object, timeoutPromise])` –≤–º–µ—Å—Ç–æ `Promise.race([streamObjectPromise, timeoutPromise])`

**üí° –ü–ê–¢–¢–ï–†–ù –†–ï–®–ï–ù–ò–Ø –¥–ª—è AI timeout –ª–æ–≥–∏–∫–∏:**
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ:** `Promise.race([—Ä–µ–∞–ª—å–Ω–æ–µ_–æ–∂–∏–¥–∞–Ω–∏–µ_–¥–∞–Ω–Ω—ã—Ö, timeoutPromise])`
- ‚ùå **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:** `Promise.race([–º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π_–≤—ã–∑–æ–≤, timeoutPromise])`
- üîß **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ö–ê–ñ–î–û–ì–û —ç—Ç–∞–ø–∞ async operation
- üìä **–ú–µ—Ç—Ä–∏–∫–∏:** –ò–∑–º–µ—Ä—è—Ç—å –≤—Ä–µ–º—è –æ—Ç –Ω–∞—á–∞–ª–∞ –¥–æ –ü–û–õ–£–ß–ï–ù–ò–Ø –¥–∞–Ω–Ω—ã—Ö, –Ω–µ –¥–æ –≤—ã–∑–æ–≤–∞ API

10. **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô —É—Ä–æ–∫: –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è AI —Å–∏—Å—Ç–µ–º (2025-06-16):**
   - **Platform timeout** - Vercel —Ñ—É–Ω–∫—Ü–∏–∏ –∏–º–µ—é—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π timeout 10-15 —Å–µ–∫—É–Ω–¥
   - **AI –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** - Gemini –º–æ–∂–µ—Ç "–∑–∞–≤–∏—Å–∞—Ç—å" –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ JSON
   - **–ö–æ–º–±–∏–Ω–∞—Ü–∏—è –ø—Ä–æ–±–ª–µ–º** - —Å–æ–∑–¥–∞–µ—Ç "—Ç–∏—Ö–∏–µ –∑–∞–≤–∏—Å–∞–Ω–∏—è" –±–µ–∑ –æ—à–∏–±–æ–∫
   - **–î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ** - `maxDuration + mode: 'tool' + enhanced prompts`

**üí° –ü–ê–¢–¢–ï–†–ù –†–ï–®–ï–ù–ò–Ø –¥–ª—è –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã—Ö AI –∑–∞–≤–∏—Å–∞–Ω–∏–π:**
- ‚úÖ **Platform:** –í—Å–µ–≥–¥–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å `maxDuration` –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö AI –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ **AI Stability:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `mode: 'tool'` –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å Gemini
- ‚úÖ **Prompts:** –ß–µ—Ç–∫–∏–µ JSON schema –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∫—Ä–∏—Ç–∏—á–Ω—ã –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
- üîß **Best Practice:** –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ç—Ä–∏ –ø–æ–¥—Ö–æ–¥–∞ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
- üìä **Vercel limits:** 60 —Å–µ–∫—É–Ω–¥ –º–∞–∫—Å–∏–º—É–º –¥–ª—è serverless —Ñ—É–Ω–∫—Ü–∏–π
